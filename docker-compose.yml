services:
  # PostgreSQL: general-purpose storage for articles, images, and web cache.
  # The old aichat-rssfeed and aichat-fetch services have been removed;
  # all web content is now fetched via the human_browser container (a12fdfeaaf78)
  # and persisted here.
  aichat-db:
    image: postgres:16
    environment:
      POSTGRES_DB: aichat
      POSTGRES_USER: aichat
      POSTGRES_PASSWORD: aichat
    volumes:
      - aichatdb:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  # FastAPI service that wraps the PostgreSQL DB with REST endpoints for
  # storing/searching articles, images, and cached web pages.
  aichat-database:
    build: ./docker/database
    environment:
      DATABASE_URL: postgresql://aichat:aichat@aichat-db:5432/aichat
    depends_on:
      - aichat-db
    ports:
      - "8091:8091"
    restart: unless-stopped

  # RSS/feed discovery (returns feed URLs; stores articles via aichat-database).
  aichat-researchbox:
    build: ./docker/researchbox
    tty: true
    stdin_open: true
    environment:
      DATABASE_URL: http://aichat-database:8091
    volumes:
      - /tmp/research:/tmp/research
    ports:
      - "8092:8092"

  aichat-memory:
    build: ./docker/memory
    ports:
      - "8094:8094"
    volumes:
      - memorydb:/data
    restart: unless-stopped

  aichat-toolkit:
    build: ./docker/toolkit
    ports:
      - "8095:8095"
    volumes:
      - ${HOME}/.config/aichat/tools:/data/tools
      - ${HOME}/git:/data/repos:ro
    restart: unless-stopped

volumes:
  aichatdb:
  memorydb:
